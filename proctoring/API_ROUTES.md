

# ğŸ§  NeuroIQ Exam Service

## API Routes & Testing Guide



## ğŸ“Œ Service Overview

* **Service Name**: NeuroIQ Exam Service
* **Base URL (Local)**: `http://localhost:8000`
* **WebSocket Base URL**: `ws://localhost:8000`

---

## ğŸ” Authentication

Most endpoints require **JWT authentication**.

**Header format**:

```http
Authorization: Bearer <JWT_TOKEN>
```

> âš ï¸ **Note**
> Wherever `session_id` or `exam_id` is mentioned in examples, replace them with **actual IDs** generated by your system.

---

## ğŸ“š API Endpoints

---

### â–¶ï¸ Start Exam

**POST** `/exam/start`

**Description**
Start a new exam session.

**Request (JSON)**:

```json
{
  "exam_id": "exam_123"
}
```

**Response (200)**:

```json
{
  "session_id": "sess_abc123",
  "exam_id": "exam_123",
  "start_time": "2026-01-31T12:00:00Z",
  "status": "in_progress"
}
```

**Authentication**: âœ… Required (JWT)

**Postman**

* Method: `POST`
* URL: `http://localhost:8000/exam/start`
* Body â†’ raw â†’ JSON
* Add `Authorization` header

---

### ğŸ“Š Get Exam Status

**GET** `/exam/status`

**Description**
Retrieve the current status of an exam session.

**Request**:

```
GET /exam/status?session_id=sess_abc123
```

**Response (200)**:

```json
{
  "session_id": "sess_abc123",
  "status": "in_progress",
  "start_time": "2026-01-31T12:00:00Z",
  "elapsed_seconds": 3600,
  "warnings": 1
}
```

**Authentication**: âœ… Required (JWT)

**Postman**

* Method: `GET`
* URL: `http://localhost:8000/exam/status`
* Params â†’ `session_id = sess_abc123`
* Add `Authorization` header

---

### ğŸ§‘â€ğŸ’» Verify Identity

**POST** `/proctor/verify-identity`

**Description**
Verify student identity using a single webcam image frame.

**Request**: `multipart/form-data`

* `session_id` â†’ query param or request parameter
* `frame` â†’ image file (`jpg` / `png`)

**Response (200)**:

```json
{
  "verified": true,
  "message": "Identity verified",
  "session_id": "sess_abc123"
}
```

**Authentication**: âœ… Required (JWT)

**Postman**

* Method: `POST`
* URL:

  ```
  http://localhost:8000/proctor/verify-identity?session_id=sess_abc123
  ```
* Body â†’ form-data

  * Key: `frame` (type: File) â†’ select image
* Add `Authorization` header

---

### ğŸ“¤ Submit Exam

**POST** `/submission/submit`

**Description**
Submit a completed exam session.

**Request (JSON)**:

```json
{
  "session_id": "sess_abc123"
}
```

**Response (200)**:

```json
{
  "session_id": "sess_abc123",
  "status": "submitted",
  "submitted_at": "2026-01-31T13:00:00Z",
  "total_warnings": 2,
  "violations_count": 1
}
```

**Authentication**: âœ… Required (JWT)

---

### ğŸ“„ Get Exam Report

**GET** `/submission/report/{session_id}`

**Description**
Fetch the final exam report including violations and metadata.

**Request**:

```
GET /submission/report/sess_abc123
```

**Response (200)** *(truncated example)*:

```json
{
  "session_id": "sess_abc123",
  "student_id": "stu_001",
  "exam_id": "exam_123",
  "start_time": "2026-01-31T12:00:00Z",
  "end_time": "2026-01-31T13:00:00Z",
  "duration_seconds": 3600,
  "status": "submitted",
  "total_warnings": 2,
  "violations": [
    {
      "violation_id": "v1",
      "violation_type": "face_missing",
      "severity": "medium",
      "timestamp": "2026-01-31T12:30:00Z",
      "description": "Face not visible"
    }
  ],
  "identity_verified": true
}
```

**Authentication**: âœ… Required (JWT)

---

### â¤ï¸ Health Check

**GET** `/health`

**Description**
Service health status.

**Response**:

```json
{
  "status": "healthy",
  "service": "exam",
  "version": "1.0.0"
}
```

**Authentication**: âŒ Not required

---

### ğŸ  Root

**GET** `/`

Returns service metadata and available endpoints.

---

## ğŸ”´ WebSocket â€“ Live Proctoring

**Endpoint**

```
ws://localhost:8000/ws/proctor/{session_id}
```

**Purpose**
Send continuous webcam frames for real-time proctoring.

---

### Client â†’ Server Payload

```json
{
  "frame": "<base64_encoded_image>",
  "timestamp": 1675171200.0
}
```

---

### Server â†’ Client Responses

**Normal**

```json
{
  "status": "ok",
  "processed": true,
  "auto_submit": false,
  "timestamp": 1675171200.0
}
```

**Violation Detected**

```json
{
  "status": "ok",
  "processed": true,
  "violation_message": "Face not detected"
}
```

**Auto-Submit Triggered**

```json
{
  "status": "auto_submit",
  "message": "Exam auto-submitted due to violations",
  "reason": "Max warnings exceeded"
}
```

**Error**

```json
{
  "status": "error",
  "message": "Frame processing error: <details>"
}
```

---

## ğŸ§ª Postman Testing Guide

### 1ï¸âƒ£ Setup Environment

* Create variable:

  ```
  base_url = http://localhost:8000
  ```
* Add header:

  ```
  Authorization: Bearer <JWT_TOKEN>
  ```

---

### 2ï¸âƒ£ Testing JSON APIs

* Choose method & URL (e.g. `{{base_url}}/exam/start`)
* Body â†’ raw â†’ JSON
* Send request and verify response

---

### 3ï¸âƒ£ Testing File Upload

* POST â†’ `{{base_url}}/proctor/verify-identity?session_id=sess_abc123`
* Body â†’ form-data

  * `frame` â†’ File â†’ image
* Add `Authorization` header

---

### 4ï¸âƒ£ Testing WebSocket

* Postman â†’ New â†’ WebSocket Request
* Connect to:

  ```
  ws://localhost:8000/ws/proctor/sess_abc123
  ```
* Send JSON payload
* Observe server messages (`ok`, `violation`, `auto_submit`)

---

### 5ï¸âƒ£ Quick Check

* Health check (no auth required):

  ```
  GET {{base_url}}/health
  ```

---

## ğŸ›  Tips & Troubleshooting

* Ensure header name is **exactly**:

  ```
  Authorization: Bearer <token>
  ```
* Use **form-data + File** for uploads (do not base64 encode manually).
* WebSocket requires a **valid session** created via `/exam/start`.
* Server closes WebSocket with code `4004` if session is invalid.

---

## ğŸ“ Code Locations

* **Routes**

  * `app/routes/exam_routes.py`
  * `app/routes/proctor_routes.py`
  * `app/routes/submission_routes.py`
* **DTOs**

  * `app/dto/exam_dto.py`
* **WebSocket Handler**

  * `app/websocket/proctoring_ws.py`

---

> *Generated by developer tooling. Update example IDs and timestamps as needed.*

